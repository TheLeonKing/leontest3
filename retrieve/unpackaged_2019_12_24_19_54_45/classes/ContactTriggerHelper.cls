public class ContactTriggerHelper {

    public static void countContacts(List<Contact> cons) {

        Map <Id,Account> accs = new Map <Id,Account>();
        Set<Id> accIds = new Set<Id>();

        // Get Employee record type ID.
        RecordTypeIDs__c RT = RecordTypeIDs__c.getOrgDefaults();
        Id rtId = (RT.ContactEmployee__c != null) ? RT.ContactEmployee__c : Schema.SObjectType.Contact.getRecordTypeInfosByName().get('Employee').getRecordTypeId();

        for (Contact con : cons) {
            if (con.RecordTypeId == rtId)
                accIds.add(con.AccountId);
        }

        AggregateResult[] aggr = [SELECT AccountId, COUNT(Id) conCount
                                  FROM Contact
                                  WHERE AccountId IN :accIds
                                  AND RecordTypeId = :rtId
                                  GROUP BY AccountId];

        for (AggregateResult ag : aggr){
            Id accId = String.valueOf(ag.get('AccountId'));
            Decimal empCount = decimal.valueOf(string.valueOf(ag.get('conCount')));

            accs.put(accId, new Account(Id=accId, NumberOfEmployees__c=empCount.intValue()));
        }

        Database.update(accs.values());
    }
}