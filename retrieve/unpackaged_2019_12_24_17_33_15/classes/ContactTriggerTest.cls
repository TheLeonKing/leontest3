@isTest
public with sharing class ContactTriggerTest {

    @testSetup
    static void setup() {
        Account acc = new Account(Name='TestAccount');
        insert acc;

        Id rtId = Schema.SObjectType.Contact.getRecordTypeInfosByName().get('Employee').getRecordTypeId();
        Contact con = new Contact(LastName = 'Test', AccountId = acc.Id, RecordTypeId = rtId);
        insert con;
    }

    static Account getTestAccount() {
        return [SELECT Id, NumberOfEmployees__c FROM Account WHERE Name = 'TestAccount' LIMIT 1];
    }

    static Contact getTestContact() {
        return [SELECT Id FROM Contact WHERE LastName = 'Test' LIMIT 1];
    }

    @isTest
    static void testAfterInsertTrigger() {
        Account acc = getTestAccount();
        System.debug('acc ' + acc);

        System.assertEquals(1, acc.NumberOfEmployees__c);
    }

    @isTest
    static void testAfterUpdateTrigger() {
        Contact con = getTestContact();

        con.FirstName = 'TestFirst';
        update con;

        Account acc = getTestAccount();
        System.assertEquals(1, acc.NumberOfEmployees__c);
    }

    @isTest
    static void testAfterDeleteTrigger() {
        Contact con = getTestContact();
        delete con;

        Account acc = getTestAccount();
        System.assertEquals(1, acc.NumberOfEmployees__c);

    }

    @isTest
    static void testAfterUndeleteTrigger() {
        Contact con = getTestContact();

        delete con;
        undelete con;

        Account acc = getTestAccount();
        System.assertEquals(1, acc.NumberOfEmployees__c);

    }

}